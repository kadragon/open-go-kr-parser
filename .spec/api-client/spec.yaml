spec_id: SPEC-api-client-001
title: "Open.go.kr API Client"
description: |
  HTTP client for fetching original document information from
  the Korean government disclosure portal (open.go.kr).

given_when_then:
  - given: "A valid agency code and date"
    when: "Client requests document list"
    then: "Returns list of documents with title, date, and URL"

  - given: "An invalid agency code"
    when: "Client requests document list"
    then: "Returns empty list without error"

  - given: "Network failure occurs"
    when: "Client requests document list"
    then: "Raises OpenGoKrError with details"

  - given: "API returns malformed response"
    when: "Client parses response"
    then: "Raises ParseError with context"

acceptance_tests:
  - id: TEST-api-client-001
    desc: "Successfully fetch documents for valid agency and date"
  - id: TEST-api-client-002
    desc: "Handle empty result gracefully"
  - id: TEST-api-client-003
    desc: "Raise appropriate error on network failure"
  - id: TEST-api-client-004
    desc: "Parse document fields correctly (title, date, url, agency)"

data_model:
  Document:
    fields:
      - name: title
        type: str
        desc: "Document title"
      - name: date
        type: str
        desc: "Disclosure date (YYYY-MM-DD)"
      - name: url
        type: str
        desc: "Link to original document"
      - name: agency_name
        type: str
        desc: "Disclosing agency name"

api_details:
  authentication:
    type: "XSRF Token (Cookie-based)"
    token_acquisition: "POST to https://www.open.go.kr/othicInfo/infoList/orginlInfoList.do"
    token_source: "XSRF-TOKEN cookie from response"
    token_usage: "Include in x-xsrf-token header for AJAX requests"
    token_lifetime: "Session-based (reusable across multiple requests)"
    token_refresh: "On 401/403 errors, clear and re-acquire token"

  endpoint: "https://www.open.go.kr/othicInfo/infoList/orginlInfoList.ajax"
  method: POST
  content_type: "application/x-www-form-urlencoded; charset=UTF-8"
  headers:
    - X-Requested-With: "XMLHttpRequest"
    - Accept: "application/json, text/javascript, */*; q=0.01"
    - x-xsrf-token: "{XSRF_TOKEN}"

  required_params:
    - insttCd: "Agency code (e.g., 1342000 for 교육부)"
    - insttCdNm: "Agency name (e.g., 교육부) - required for filtering"
    - startDate: "Start date (YYYYMMDD)"
    - endDate: "End date (YYYYMMDD)"
    - viewPage: "Page number"
    - rowPage: "Results per page"
  optional_params:
    - eduYn: "Include elementary/middle/high schools (Y/N, default: N)"
    - sort: "Sort order (s: date desc, default: s)"
    - kwd: "Search keyword"
    - othbcSeCd: "Disclosure type (1: full, 2: partial)"
    - insttSeCd: "Agency type filter"

  response_format:
    structure: "JSON (nested in 'result' key)"
    fields:
      - rtnList: "Array of document objects"
      - rtnTotal: "Total count of documents"
    document_fields:
      - INFO_SJ: "Document title"
      - PRDCTN_DT: "Production datetime (YYYYMMDDHHmmss)"
      - PROC_INSTT_NM: "Agency name"
      - PRDCTN_INSTT_REGIST_NO: "Document registration number (for URL construction)"
      - INSTT_SE_CD: "Institution type code (for URL construction)"

  url_construction:
    pattern: "https://www.open.go.kr/othicInfo/infoList/infoListDetl.do?prdnNstRgstNo={PRDCTN_INSTT_REGIST_NO}&prdnDt={PRDCTN_DT}&nstSeCd={INSTT_SE_CD}"
    required_fields:
      - PRDCTN_INSTT_REGIST_NO
      - PRDCTN_DT
      - INSTT_SE_CD

dependencies:
  - governance: coding-style
  - governance: patterns

linked_tasks: []
